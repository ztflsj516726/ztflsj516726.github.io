---
title: å‰ç«¯ä»£ç†ä¸è·¨åŸŸé—®é¢˜
date: 2025-07-02 10:29:06
tags:
 - è·¨åŸŸ
 - ä»£ç†
---

# å‰ç«¯ä»£ç†ä¸è·¨åŸŸé—®é¢˜è§£å†³ï¼ˆæ·±å…¥ç†è§£ï¼‰

## ğŸ“Œ **è·¨åŸŸæ˜¯ä»€ä¹ˆï¼Ÿ**

ä»æµè§ˆå™¨çš„è§’åº¦ï¼Œ**è·¨åŸŸï¼ˆCORSï¼‰** æ˜¯æŒ‡ï¼š

> æµè§ˆå™¨å‰ç«¯å‘å‡ºçš„è¯·æ±‚ï¼Œ**åè®® + åŸŸå + ç«¯å£**ï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªä¸ä¸€æ ·ï¼Œå°±ç®—æ˜¯è·¨åŸŸã€‚

**ä¸¾ä¸ªä¾‹å­ï¼š**

| å‰ç«¯åœ°å€                                        | è¯·æ±‚åœ°å€                                        | æ˜¯å¦è·¨åŸŸ | åŸå›      |
| ----------------------------------------------- | ----------------------------------------------- | -------- | -------- |
| [http://localhost:5173](http://localhost:5173/) | [http://localhost:8080](http://localhost:8080/) | âœ”ï¸ è·¨åŸŸ   | ç«¯å£ä¸åŒ |
| [http://localhost](http://localhost/)           | [https://localhost](https://localhost/)         | âœ”ï¸ è·¨åŸŸ   | åè®®ä¸åŒ |
| [http://www.a.com](http://www.a.com/)           | [http://api.a.com](http://api.a.com/)           | âœ”ï¸ è·¨åŸŸ   | åŸŸåä¸åŒ |
| [http://www.a.com](http://www.a.com/)           | [http://www.a.com](http://www.a.com/)           | âŒ ä¸è·¨åŸŸ | å®Œå…¨ç›¸åŒ |

## âœ… æ€ä¹ˆè§£å†³è·¨åŸŸ

### 1ï¸âƒ£ æœ¬åœ°å¼€å‘ï¼šå‰ç«¯ä»£ç†ï¼ˆæœ€å¸¸è§ï¼‰

- å‰ç«¯ç”¨ Viteã€Webpack çš„ dev server åšè½¬å‘ï¼š

```json
proxy: {
  '/dev-api': {
    target: 'http://localhost:8080',
    changeOrigin: true,
    rewrite: path => path.replace(/^\/dev-api/, '')
  }
}
```

- æµè§ˆå™¨ä»¥ä¸ºæ˜¯åŒæºï¼ˆåŒç«¯å£ï¼‰ï¼Œå…¶å®ç”±æœ¬åœ° dev server è½¬å‘åˆ°åç«¯ï¼Œå‰ç«¯ä¸æ„ŸçŸ¥è·¨åŸŸã€‚

> [!IMPORTANT]
>
> æ˜¯æŠŠè¯·æ±‚å‰ç¼€ä¸º`/dev-api`çš„è¯·æ±‚éƒ½è¿›è¡Œä»£ç†ï¼Œ æ˜¯æ ¹æ®ç¯å¢ƒå˜é‡` VITE_APP_BASE_API `é…ç½®çš„ï¼Œ `.env.development`å’Œ`.env.production`ä¸­ä¸ä¸€æ ·ã€‚

### 2ï¸âƒ£ ç”Ÿäº§ï¼šNginx åå‘ä»£ç†

- è®¿é—®åŸŸåï¼š`http://www.a.com`
- å‰ç«¯é™æ€èµ„æºï¼šç”± Nginx æœåŠ¡

å› ä¸ºåœ¨å‰ç«¯è¯·æ±‚æ¨¡æ¿request.jsçš„`baseUrl`ä¸ºVITE_APP_BASE_APIï¼ˆ/prod-apiï¼‰,æ‰€ä»¥æ‰€æœ‰é€šè¿‡requestæ¨¡æ¿å‘èµ·çš„è¯·æ±‚éƒ½å¸¦æœ‰å‰ç¼€/prod-api,è€Œnginxä¼šå¯¹è¿™äº›è¯·æ±‚è¿›è¡Œåå‘ä»£ç†ï¼Œè½¬å‘åˆ°`http://47.108.195.148`ï¼Œè¿›è€Œè§£å†³è·¨åŸŸé—®é¢˜ï¼Œ`rewrite`çš„ä½œç”¨æ˜¯å»æ‰/prod-apiçš„è¯·æ±‚è·¯å¾„ï¼Œå˜æˆåç«¯çœŸå®çš„è¯·æ±‚è·¯å¾„ã€‚

```json
server {
    listen 80;
    server_name localhost;

    # é™æ€èµ„æºç›®å½•
    location / {
        root /usr/share/nginx/html;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # æ¥å£ä»£ç†ï¼šå°† /prod-api è½¬å‘åˆ°åç«¯æœåŠ¡ï¼ˆå¦‚ Spring Bootï¼‰
    location /prod-api/ {
        rewrite ^/prod-api/(.*)$ /$1 break;  # å»æ‰å‰ç¼€
        proxy_pass http://47.108.195.148:8080/;  # æ³¨æ„è¿™é‡Œè¦æœ‰æ–œæ  ï¼ˆåç«¯ipï¼‰
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

- è¯·æ±‚æ¥å£ï¼šä¹Ÿæ˜¯è®¿é—® `http://www.a.com/prod-api`ï¼ŒNginx å†åå‘ä»£ç†åˆ°åç«¯ `http://47.108.195.148:8080/`
- åœ¨æµè§ˆå™¨çœ‹æ¥ï¼šè¯·æ±‚æ˜¯åŒæºï¼Œæ²¡è·¨åŸŸã€‚
